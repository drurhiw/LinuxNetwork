## Содержание ##
1. [Part 1. Инструмент ipcalc](#part-1-инструмент-ipcalc)
2. [Part 2. Статическая маршрутизация между двумя машинами](#part-2-cтатическая-маршрутизация-между-двумя-машинами)
3. [Part 3. Утилита iperf3](#part-3-утилита-iperf3)
4. [Part 4. Сетевой экран](#part-4-сетевой-экран)
5. [Part 5. Статическая маршрутизация сети](#part-5-статическая-маршрутизация-сети)
6. [Part 6. Динамическая настройка IP с помощью DHCP](#part-6-динамическая-настройка-ip-с-помощью-dhcp)
7. [Part 7. NAT](#part-7-nat)
8. [Part 8. Дополнительно. Знакомство с SSH Tunnels](#part-8-дополнительно-знакомство-с-ssh-tunnels)

## Part 1. Инструмент ipcalc ##
**Поднимаем виртуальную машину (далее -- ws1). Переименовываем с user-1 на ws1 с помощью команды `sudo hostnamectl set-hostname ws1`**

![img_p1](images/Part_1.png)<br>*Рис.1 Переименование виртуальной машины*<br>

<br>

**1.1. Сети и маски**
**Для работы с инструментом ipclac устанавливаем его с помощью команды `sudo apt-get install ipcalc`**

**Адрес сети 192.167.38.54/13**

![img_p1.1](images/Part_1.1.png)<br>*Рис.2 Адрес сети 192.167.38.54/13*<br>

<br>

**Перевод маски 255.255.255.0 в префиксную и двоичную запись, /15 в обычную и двоичную, 11111111.11111111.11111111.11110000 в обычную и префиксную**

**1.1. Переводим маску 255.255.255.0 в префиксную и двоичную запись**

* 255.255.255.0 - в префиксной записи 24
* 255.255.255.0 - в двоичной записи 11111111.11111111.11111111.00000000

![img_p1.2](images/Part_1.2.png)<br>*Рис.3 Маска 255.255.255.0*<br>

<br>

**1.2. Переводим маску /15 в обычную и двоичную запись**

* /15 - в обычной записи 255.254.0.0
* /15 - в двоичной записи 11111111.11111110.00000000.00000000

![img_p1.3](images/Part_1.3.png)<br>*Рис.4 Маска /15*<br>

<br>

**1.3. Переводим маску 11111111.11111111.11111111.11110000 в обычную и префиксную запись. В двоичном отображении маска подсети выглядит: 11111111.11111111.11111111.11110000 - содержит 28 единиц, что соответствует записи /28**

* 11111111.11111111.11111111.11110000 - в обычной записи 255.255.255.240
* 11111111.11111111.11111111.11110000 - в префиксной записи 28

![img_p1.4](images/Part_1.4.png)<br>*Рис.5 Маска 11111111.11111111.11111111.11110000 (/28)*<br>

<br>

**Минимальный и максимальный хост в сети 12.167.38.4 при масках: /8, 11111111.11111111.00000000.00000000, 255.255.254.0 и /4**

**1.1. при маске /8**

* минимальный хост - 12.0.0.1
* максимальный хост - 12.255.255.254

![img_p1.5](images/Part_1.5.png)<br>*Рис.6 Минимальный и максимальный хост при маске /8*<br>

<br>

**1.2. при 1111.11111111.00000000.00000000 (/16)**

* минимальный хост - 12.167.0.1
* максимальный хост - 12.167.255.254

![img_p1.6](images/Part_1.6.png)<br>*Рис.7 Минимальный и максимальный хост при маске 11111111.11111111.00000000.00000000*<br>

<br>

**1.3. При 255.255.254.0**

* минимальный хост - 12.167.38.1
* максимальный хост - 12.167.39.254

![img_p1.7](images/Part_1.7.png)<br>*Рис.8 Минимальный и максимальный хост при маске 255.255.254.0*<br>

<br>

**1.4. При /4**

* минимальный хост - 0.0.0.1
* максимальный хост - 15.255.255.254

![img_p1.8](images/Part_1.8.png)<br>*Рис.9 Минимальный и максимальный хост при маске /4*<br>

<br>

**1.2. localhost**

**Определим, можно ли обратиться к приложению, работающему на localhost, со следующими IP: 194.34.23.100, 127.0.0.2, 127.1.0.1, 128.0.0.1**

* IP-адреса, начинающиеся с 127., зарезервированы для петлевых (loopback) интерфейсов. Это означает, что все адреса в диапазоне от 127.0.0.0 до 127.255.255.255 относятся к localhost и могут быть использованы для обращения к приложениям, работающим на вашем компьютере.
* Таким образом, можно обратиться к приложению с IP: 127.0.0.2, 127.1.0.1 Нельзя обратиться к приложению с IP: 194.34.23.100, 128.0.0.1

**1.3. Диапазоны и сегменты сетей**

**1. Определим, какие из перечисленных IP можно использовать в качестве публичного, а какие только в качестве частных: 10.0.0.45, 134.43.0.2, 192.168.4.2, 172.20.250.4, 172.0.2.1, 192.172.0.1, 172.68.0.2, 172.16.255.255, 10.10.10.10, 192.169.168.1**

* Для определения, какие IP-адреса могут быть использованы в качестве публичных, а какие в качестве частных, мы можем опираться на следующие диапазоны частных IP-адресов:<br>
    * 10.0.0.0 — 10.255.255.255<br>
    * 172.16.0.0 — 172.31.255.255<br>
    * 192.168.0.0 — 192.168.255.255<br>
* Адреса, попадающие в эти диапазоны, являются частными и используются в локальных сетях. <br>
* Частные IP-адреса:<br>
    * 10.0.0.45<br>
    * 192.168.4.2<br>
    * 172.20.250.4<br>
    * 172.16.255.255<br>
    * 10.10.10.10<br>
* Публичные IP-адреса:<br>
    * 134.43.0.2<br>
    * 172.0.2.1<br>
    * 192.172.0.1<br>
    * 172.68.0.2<br>
    * 192.169.168.1<br>

<br>

**2. Определим, какие из перечисленных IP адресов шлюза возможны у сети 10.10.0.0/18: 10.0.0.1, 10.10.0.2, 10.10.10.10, 10.10.100.1, 10.10.1.255**

* Расчет диапазона сети 10.10.0.0/18: <br>
    * IP-адрес сети: 10.10.0.0 <br>
    * Маска сети: /18 (255.255.192.0) <br>
    * Диапазон IP-адресов: от 10.10.0.0 до 10.10.63.255 <br>
* Могут быть адресами шлюза: <br>
    * 10.10.0.2 <br>
    * 10.10.10.10 <br>
    * 10.10.1.255 <br>
* Не могут быть адресами шлюза: <br>
    * 10.0.0.1 <br>
    * 10.10.100.1 <br>

<br>

## Part 2. Статическая маршрутизация между двумя машинами ##

**1. Поднимаем две виртуальные машины (далее -- ws1 и ws2)**

**1.1. С помощью команды `ip a` смотрим существующие сетевые интерфейсы**

![img_p1.9](images/Part_1.9.png)<br>*Рис.10 ws1*<br>

<br>

![img_p1.10](images/Part_1.10.png)<br>*Рис.11 ws2*<br>

<br>

**2. Опишем сетевой интерфейс, соответствующий внутренней сети, на обеих машинах и зададим следующие адреса и маски: ws1 - 192.168.100.10, маска /16, ws2 - 172.24.116.8, маска /12**<br>

* Для работы с сетевым интерфейсом внутренней сети необходимо выключить виртуальную машину и перейти в раздел Settings->Network->Adapter <br>
* Далее включаем функцию "Enable Network Adapter". В разделе "Attached to" выбираем Internal Network. Name: intnet.<br>
**Описание: в каждой машине по 3 интерфейса:**<br>
* lo (local loopback), нужен для работы локальных сервисов и приложений по сетевым протоколамб всегда стандартный<br>
* enp0s3 - интерфейс адаптера, подключен к сети по протоколу dhcp в режиме NAT<br>
* enp0s8 - еще один интерфейс адаптера с заданным статическим адресом (без выхода в интернет)<br>

![img_p1.11](images/Part_1.11.png)
![img_p1.12](images/Part_1.12.png)<br>*Рис.12 `ip a`*<br>

<br>

* Измененные файлы etc/netplan/00-installer-config.yaml для каждой машины

![img_p1.13](images/Part_1.13.png)
![img_p1.14](images/Part_1.14.png)<br>*Рис.13 адреса и маски ws1 и ws2*<br>

<br>

**3. Выполним команду `netplan apply` для перезапуска сервиса сети.**

![img_p1.15](images/Part_1.15.png)
![img_p1.16](images/Part_1.16.png)<br>*Рис.14 команда `netplan apply` и `ip a`*<br>

<br>

**2.1. Добавление статического маршрута вручную**

**Добавление статического маршрута от одной машины до другой и обратно при помощи команды вида `ip r add`**

**Добавим статический маршрут от одной машины до другой и обратно при помощи команды вида `ip r add`**

![img_p1.21](images/Part_1.21.png)
![img_p1.22](images/Part_1.22.png)<br>*Рис.15 команда `ip r add`*<br>

<br>

**Пропингуем соединение между машинами**

![img_p1.19](images/Part_1.19.png)
![img_p1.20](images/Part_1.20.png)<br>*Рис.16 пропингуем соединение между машинами*<br>

<br>

**2.2. Добавление статического маршрута с сохранением**

**Перезапустим машины**

* Используем команду `sudo reboot`

**Добавим статический маршрут от одной машины до другой с помощью файла /etc/netplan/00-installer-config.yaml**

![img_p1.23](images/Part_1.23.png)<br>*Рис.17 добавим статический маршрут от одной машины до другой*<br>

<br>

**Пропингуем соединение между машинами**

![img_p1.26](images/Part_1.26.png)<br>*Рис.18 пропингуем соединение между машинами*<br>

<br>

## Part 3. Утилита iperf3 ##

**3.1. Скорость соединения**

**Переведем: 8 Mbps в MB/s, 100 MB/s в Kbps, 1 Gbps в Mbps.**

* 8 Mbps = 1 MB/s <br>
* 100 MB/s = 8000 Kbps <br>
* 1 Gbps = 1000 Mbps <br>

<br>

**3.2. Утилита iperf3**

**Измерим скорость соединения между ws1 и ws2**

* ws1 выступает в роли сервера. Запуск iperf3 сервер, команда `iperf3 -s -f m`

![img_p1.27](images/Part_1.27.png)<br>*Рис.19 запуск iperf3 сервер*<br>

<br>

* ws2 выступает в роли клиента. Запуск iperf3 клиент, команда `iperf3 -c 192.168.100.10`

![img_p1.28](images/Part_1.28.png)<br>*Рис.20 запуск iperf3 клиент*<br>

<br>

## Part 4. Сетевой экран ##

**4.1. Утилита iptables**

**Создадим файл /etc/firewall.sh, имитирующий фаерволл, на ws1 и ws2**

* Нужно добавить в файл подряд следующие правила:

1) На ws1 применим стратегию, когда в начале пишется запрещающее правило, а в конце пишется разрешающее правило (это касается пунктов 4 и 5).<br>

2) На ws2 применим стратегию, когда в начале пишется разрешающее правило, а в конце пишется запрещающее правило (это касается пунктов 4 и 5).<br>

3) Откроем на машинах доступ для порта 22 (ssh) и порта 80 (http).<br>

4) Запретим echo reply (машина не должна «пинговаться», т.е. должна быть блокировка на OUTPUT).<br>

5) Разрешим echo reply (машина должна «пинговаться»).<br>

<br>

![img_p1.30](images/Part_1.30.png)<br>*Рис.21 имитация сетевых экранов на виртуальных машинах ws1 и ws2*<br>

<br>

**Запустим файлы на обеих машинах командами `chmod +x /etc/firewall.sh` и `/etc/firewall.sh`**

![img_p1.31](images/Part_1.31.png)<br>*Рис.22 запускаем файл на ws1*<br>

<br>

![img_p1.32](images/Part_1.32.png)<br>*Рис.23 запускаем файл на ws2*<br>

<br>

* Разница между стратегиями в том, что в первом файле первым подходящим правилом для пакета является запрет, а во втором - разрешение. Применяется только первое подходящее правило, остальные игнорируются.

**4.2. Утилита nmap**

**Командой ping найдём машину, которая не «пингуется», после чего утилитой nmap покажим, что хост машины запущен**

![img_p1.33](images/Part_1.33.png)<br>*Рис.24 пингуем ws1 с ws2*<br>

<br>

![img_p1.34](images/Part_1.34.png)<br>*Рис.25 пингуем ws2 с ws1*<br>

<br>

![img_p1.35](images/Part_1.35.png)<br>*Рис.26 запускаем с помощью команды `nmap 172.24.116.8`*<br>

<br>

* находим машину, которая не «пингуется», утилита nmap говорит о том что Host is up, значит хост машины запущен <br>

**Сохраняем дампы образов виртуальных машин**

## Part 5. Статическая маршрутизация сети ##

![img_p1.36](images/Part_1.36.png)<br>

<br>

**Поднимем пять виртуальных машин (3 рабочие станции (ws11, ws21, ws22) и 2 роутера (r1, r2))**

**5.1. Настройка адресов машин**

**Настроим конфигурации машин в etc/netplan/00-installer-config.yaml согласно сети на рисунке**

![img_p1.37](images/Part_1.37.png)<br>*Рис.27 ws11*<br>
![img_p1.40](images/Part_1.40.png)<br>*Рис.28 ws21*<br>
![img_p1.41](images/Part_1.41.png)<br>*Рис.29 ws22*<br>
![img_p1.38](images/Part_1.38.png)<br>*Рис.30 r1*<br>
![img_p1.39](images/Part_1.39.png)<br>*Рис.31 r2*<br>

<br>

**Перезапустим сервис сети. Если ошибок нет, то командой ip -4 a проверим, что адрес машины задан верно. Также пропингуем ws22 с ws21. Аналогично пропингуем r1 с ws11**

![img_p1.42](images/Part_1.42.png)<br>*Рис.32 ws11*<br>
![img_p1.43](images/Part_1.43.png)<br>*Рис.33 ws21*<br>
![img_p1.44](images/Part_1.44.png)<br>*Рис.34 ws22*<br>
![img_p1.45](images/Part_1.45.png)<br>*Рис.35 r1*<br>
![img_p1.46](images/Part_1.46.png)<br>*Рис.36 r2*<br>

<br>

**Пропингуем ws22 с ws21:**

![img_p1.47](images/Part_1.47.png)<br>*Рис.37 ws22 с ws21*<br>

<br>

**Пропингуем r1 с ws11:**

![img_p1.48](images/Part_1.48.png)<br>*Рис.38 r1 с ws11*<br>

<br>

**5.2. Включение переадресации IP-адресов**

**Для включения переадресации IP, выполни команду на роутерах: `sysctl -w net.ipv4.ip_forward=1`*При таком подходе переадресация не будет работать после перезагрузки системы***

![img_p1.49](images/Part_1.49.png)<br>*Рис.39 r1*<br>
![img_p1.50](images/Part_1.50.png)<br>*Рис.40 r2*<br>

<br>

**Откроем файл /etc/sysctl.conf и добавим в него следующую строку: `net.ipv4.ip_forward = 1` *При использовании этого подхода, IP-переадресация включена на постоянной основе***

![img_p1.51](images/Part_1.51.png)<br>*Рис.41 r1*<br>
![img_p1.52](images/Part_1.52.png)<br>*Рис.42 r2*<br>

<br>

**5.3. Установка маршрута по-умолчанию**

**Добавим gateway4 [ip роутера] в файлы конфигураций рабочих станций, перезапустим сервис сети и вызовем команду ip r:**

![img_p1.53](images/Part_1.53.png)<br>*Рис.43 ws11*<br>
![img_p1.54](images/Part_1.54.png)<br>*Рис.44 ws21*<br>
![img_p1.55](images/Part_1.55.png)<br>*Рис.45 ws22*<br>

<br>

**Пропингуем с ws11 роутер r2 и покажем на r2, что пинг доходит с помощью команды `tcpdump -tn -i eth1`:**

![img_p1.56](images/Part_1.56.png)
![img_p1.57](images/Part_1.57.png)<br>*Рис.47 пропингуем с ws11 роутер r2*<br>

<br>

**5.4. Добавление статических маршрутов**

**Добавим в роутеры r1 и r2 статические маршруты в файле конфигураций, перезапустим сервис сети и вызовем команду ip r:**

![img_p1.58](images/Part_1.58.png)<br>*Рис.48 r1*<br>
![img_p1.59](images/Part_1.59.png)<br>*Рис.49 r2*<br>

<br>

**Вызов команд `ip r list 10.10.0.0/[маска сети]` и `ip r list 0.0.0.0/0` на ws11:**

![img_p1.60](images/Part_1.60.png)<br>*Рис.50*<br>

<br>

* Для адреса 10.10.0.0/[маска сети] был выбран маршрут, отличный от 0.0.0.0/0, потому что маска /18 описывает маршрут к сети точнее, в отличие от маски /0. 

<br>

**5.5. Построение списка маршрутизаторов**

**Запуск на r1 команды дампа tcpdump -tnv -i ent0 и построение списка маршрутизаторов на пути от ws11 до ws21 при помощи утилиты traceroute:**

![img_p5.5](images/Part_5.5.png)<br>*Рис.51 r1*<br>
![img_p5.5.1](images/Part_5.5.1.png)<br>*Рис.52 r2*<br>

<br>

* С помощью утилиты traceroute я определила последовательность маршрутизаторов от VM PS-ws11 до VM PS-ws21. Команда traceroute отправляет UDP пакеты с постепенно увеличивающимся значением TTL (Time To Live). Сначала отправляется пакет с TTL, равным 1, и фиксируется адрес ответившего узла. Затем TTL увеличивается до 2, затем до 3, и так продолжается, пока пакет не достигнет конечной цели. Каждый раз отправляется по три пакета, и для каждого из них измеряется время прохождения. Пакеты отправляются на случайные порты, которые, скорее всего, не заняты. Когда утилита traceroute получает от целевого узла сообщение о недоступности порта, трассировка завершается.

<br>

**5.6. Использование протокола ICMP при маршрутизации**

**Запустим на r1 перехват сетевого трафика, проходящего через eth0 с помощью команды: `tcpdump -n -i eth0 icmp` и пропингуем с ws11 несуществующий IP (например, 10.30.0.111) с помощью команды: `ping -c 1 10.30.0.111`**

![img_p5.6](images/Part_5.6.png)<br>*Рис.53 перехват сетевого трафика*<br>
![img_p5.6.1](images/Part_5.6.1.png)<br>*Рис.54 пинг с ws11 несуществующий IP*<br>

<br>

## Part 6. Динамическая настройка IP с помощью DHCP ##

**Для r2 настроим в файле /etc/dhcp/dhcpd.conf конфигурацию службы DHCP:**

**1. Укажим адрес маршрутизатора по-умолчанию, DNS-сервер и адрес внутренней сети**

![img_p6.1](images/Part_6.1.png)<br>*Рис.55 файл dhcpd.conf*<br>

<br>

**2. В файле resolv.conf пропиши nameserver 8.8.8.8**

![img_p6.2](images/Part_6.2.png)<br>*Рис.56 файл resolv.conf*<br>

<br>

**Перезагрузим службу DHCP командой `systemctl restart isc-dhcp-server`. Машину ws21 перезагрузим при помощи `reboot` и через `ip a` покажим, что она получила адрес. Также пропингуем ws22 с ws21.**

![img_p6.3](images/Part_6.3.png)<br>*Рис.57 перезагрузим службу DHCP*<br>

<br>

![img_p6.4](images/Part_6.4.png)<br>*Рис.58 через `ip a` покажим, что ws21 получила адрес*<br>

<br>

![img_p6.5](images/Part_6.5.png)<br>*Рис.59 пропингуем ws22 с ws21*<br>

<br>

**Укажeм MAC адрес у ws11, для этого в etc/netplan/00-installer-config.yaml надо добавить строки: macaddress: 10:10:10:10:10:BA, dhcp4: true.**

![img_p6.6](images/Part_6.6.png)<br>*Рис.60 файл 00-installer-config.yaml*<br>

<br>

**Для r1 настроим аналогично r2, но сделаем выдачу адресов с жесткой привязкой к MAC-адресу (ws11)**

![img_p6.7](images/Part_6.7.png)<br>*Рис.61 адрес маршрутизатора по-умолчанию, DNS-сервер и адрес внутренней сети*<br>

<br>

![img_p6.8](images/Part_6.8.png)<br>*Рис.62 файл resolv.conf*<br>

<br>

![img_p6.9](images/Part_6.9.png)<br>*Рис.63 перезагрузим службу DHCP*<br>

<br>


**Запросим с ws21 обновление ip адреса**

![img_p6.10](images/Part_6.10.png)<br>*Рис.64 обновление ip адреса*<br>

<br>

![img_p6.11](images/Part_6.11.png)<br>*Рис.65 обновление ip адреса*<br>

<br>

* Команда `sudo dhclient -r enp0s8` используется для освобождения IP-адреса, который был получен через DHCP для интерфейса enp0s8. В этой команде используется несколько опций DHCP клиента dhclient. Вот подробное объяснение:<br>

* sudo: Запуск команды с правами суперпользователя (root).<br>
* dhclient: DHCP клиент, который используется для получения и управления IP-адресами через протокол DHCP.<br>
* -r: Опция для освобождения (release) текущего IP-адреса, который был назначен интерфейсу enp0s8.<br>
* enp0s8: Имя сетевого интерфейса, для которого выполняется команда.<br>

<br>

## Part 7. NAT ##

**Установила утилиту веб-сервер Apache (`sudo apt install apache2`)**

**В файле /etc/apache2/ports.conf на ws22 и r1 изменим строку Listen 80 на Listen 0.0.0.0:80, то есть сделаем сервер Apache2 общедоступным**

![img_p7.1](images/Part_7.1.png)
![img_p7.2](images/Part_7.2.png)<br>*Рис.66 файлы ports.conf на ws22 и r1*<br>

<br>

**Запустим веб-сервер Apache командой `service apache2 start` на ws22 и r1.**

![img_p7.3](images/Part_7.3.png)
![img_p7.4](images/Part_7.4.png)<br>*Рис.67 веб-сервер Apache на ws22 и r1*<br>

<br>

**Добавим в фаервол, созданный по аналогии с фаерволом из Части 4, на r2 следующие правила:**

1) Удаление правил в таблице filter - iptables -F;<br>

2) Удаление правил в таблице "NAT" - iptables -F -t nat;<br>

3) Отбрасывать все маршрутизируемые пакеты - iptables --policy FORWARD DROP.<br>

![img_p7.5](images/Part_7.5.png)
![img_p7.6](images/Part_7.6.png)<br>*Рис.68 добавим в фаервол правила*<br>

<br>

**Проверим соединение между ws22 и r1 командой ping**
*При запуске файла с этими правилами, ws22 не должна «пинговаться» с r1.*

![img_p7.7](images/Part_7.7.png)<br>*Рис.69 r1*<br>
![img_p7.8](images/Part_7.8.png)<br>*Рис.68 ws22*<br>

<br>

**Добавим в файл ещё одно правило:**

4) Разрешить маршрутизацию всех пакетов протокола ICMP.<br>

![img_p7.9](images/Part_7.9.png)<br>*Рис.69 разрешить маршрутизацию всех пакетов протокола ICMP*<br>

<br>

* Запуcкаем файл также, как выше.

**Проверим соединение между ws22 и r1 командой ping.**
*При запуске файла с этими правилами, ws22 должна «пинговаться» с r1.*

![img_p7.10](images/Part_7.10.png)<br>*Рис.70 r1*<br>
![img_p7.11](images/Part_7.11.png)<br>*Рис.71 ws22*<br>

<br>

**Добавим в файл ещё два правила:**

5) Включиим SNAT, а именно маскирование всех локальных ip из локальной сети, находящейся за r2 (по обозначениям из Части 5 - сеть 10.20.0.0).

6) Включиим DNAT на 8080 порт машины r2 и добавить к веб-серверу Apache, запущенному на ws22, доступ извне сети.

![img_p7.12](images/Part_7.12.png)<br>*Рис.72 добавим в фаервол правила*<br>

<br>

*На всех VM (Route r1, Route r2, ws11, ws21, ws22) отключил Адаптер на котором был подключен сетевой адаптер NAT*<br>

**Проверим соединение по TCP для SNAT: для этого с ws22 подключиться к серверу Apache на r1 командой: `telnet [адрес] [порт]`**

![img_p7.13](images/Part_7.13.png)<br>*Рис.73 ws22*<br>

<br>

**Проверим соединение по TCP для DNAT: для этого с r1 подключиться к серверу Apache на ws22 командой telnet (обращаться по адресу r2 и порту 8080)**

![img_p7.14](images/Part_7.14.png)<br>*Рис.74 r1*<br>

<br>

* Сохранила дампы образов виртуальных машин

## Part 8. Дополнительно. Знакомство с SSH Tunnels ##

**Запустим на r2 фаервол с правилами из Части 7**

![img_p8.1](images/Part_8.1.png)<br>*Рис.75 фаервол*<br>

<br>

**Запустим веб-сервер Apache на ws22 только на localhost (то есть в файле /etc/apache2/ports.conf изменим строку Listen 80 на Listen localhost:80)**

![img_p8.2](images/Part_8.2.png)<br>*Рис.76 файл ports.conf*<br>

<br>

**Воспользуемся Local TCP forwarding с ws21 до ws22, чтобы получить доступ к веб-серверу на ws22 с ws21.**

![img_p8.3](images/Part_8.3.png)<br>*Рис.77 с помощью команды `ssh -L 8080:localhost:80 ws22@10.20.0.20`*<br>

<br>

**Проверка подключения:**

![img_p8.4](images/Part_8.4.png)<br>*Рис.78 Проверка подключения*<br>

<br>

**Воспользуемся Remote TCP forwarding c ws11 до ws22, чтобы получить доступ к веб-серверу на ws22 с ws11**

![img_p8.5](images/Part_8.5.png)<br>*Рис.79 с помощью команды `ssh -R 8080:localhost:80 10.20.0.20`*<br>

<br>

**Проверка подключения:**

![img_p8.6](images/Part_8.6.png)<br>*Рис.80 Проверка подключения*<br>

<br>